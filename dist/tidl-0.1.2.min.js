/*! tidl - v0.1.2 - 2014-12-31 */!function(){"uses strict;";function a(a,b){return void 0===a||void 0===b?!1:null===a||null===b?!1:a.length<b.length?!1:a.substr(a.length-b.length,b.length)===b?!0:!1}function b(a,b,c,d,e){null===b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));for(var f=d||0,g=e||0;b>f;++f)"	"==a.charAt(f)?g+=c-g%c:++g;return g}function c(a,b){for(i=0;i<a.length;++i)if(a[i].Name==b)return a[i];return null}function d(a,b){var c=null;for(var d in a)if(c=a[d],c.Name==b)return c;return null}function e(a,b){for(i=0;i<this.Attributes.length;++i){var c=this.Attributes[i];if(c.Name==a){if(void 0===b)return c;if(c.Values[0]==b)return c}}return null}function f(){var a=this.getAttribute("description");return a?a.Values[0]:null}function g(){function a(){this.Major="0",this.Minor="0",this.Build="0"}a.prototype.toString=function(){return this.Major+"."+this.Minor+"."+this.Build};var b=new a,c=this.getAttribute("version");if(null!==c){var d=c.Values[0].split(".");b.Major=d[0],b.Minor=d[1],b.Build=d[2]}return b}function h(){return this.Name="",this.Type="String",this.Values=[],this.toString=function(){var a="@"+this.Name+" ",b=0;for("String"!==this.Type&&this.Values.length>0&&(a+=this.Values[0],b=1);b<this.Values.length;b++)0!==b&&(a+=","),a+=JSON.stringify(this.Values[b]);return a+=";"},this}function j(){return this.Name="",this.Types=[],this.toString=function(){var a=this.Name;if(this.Types.length>0){for(a+="<",i=0;i<this.Types.length;++i)0!==i&&(a+=","),a+=this.Types[i].toString();a+=">"}return a},this}function k(){return this.Name="",this.Type=new j,this.Modifiers=[],this.Mandatory=!1,this.toString=function(){var a="";for(i=0;i<this.Modifiers.length;++i)a+=this.Modifiers[i]+" ";return this.Mandatory&&(a+="mandatory "),a+=this.Type.toString()+" ",a+=this.Name},this}function l(){return this.Name="",this.Return=new j,this.Parameters={},this.Attributes=[],this.Exceptions=[],this.BaseTypes=[],this.IsAsync=!1,this.type="",this.toString=function(){var a="",b=0;this.IsAsync&&(a+="async "),a+="operation"==this.type?this.Return.toString()+" ":this.type+" ",a+=this.Name+"(";for(var c in this.Parameters)0!==b&&(a+=","),a+=this.Parameters[c].toString(),b++;if(a+=")",this.Exceptions.length>0)for(a+=" throws ",b=0;b<this.Exceptions.length;++b)0!==b&&(a+=","),a+=this.Exceptions[b];else if(this.BaseTypes.length>0)for(a+=" extends ",b=0;b<this.BaseTypes.length;++b)0!==b&&(a+=","),a+=this.BaseTypes[b];return a+="\n{\n",this.Attributes.forEach(function(b){a+="	"+b.toString()+"\n"}),a+="}"},this}function m(){return this.Name="",this.Service="",this.Attributes=[],this.Operations=[],this.Types=[],this.Typedefs=[],this.Enumerations=[],this.Exceptions=[],this.Events=[],this.getAttribute=e,this.getDescription=f,this.Version=g,this.getOperation=function(a){return c(this.Operations,a)},this.getType=function(a){return c(this.Types,a)},this.getTypedef=function(a){return c(this.Typedefs,a)},this.getEnumeration=function(a){return c(this.Enumerations,a)},this.getEvent=function(a){return c(this.Events,a)},this.getException=function(a){return c(this.Exceptions,a)},this.toString=function(){var a="interface ";return a+=this.Name,this.Service&&(a+=" exposes "+this.Service),a+=" {\n",this.Attributes.forEach(function(b){a+="	"+b.toString()+"\n"}),this.Operations.forEach(function(b){a+="\n	"+b.toString().replace(/\n/g,"\n	")+"\n"}),this.Types.forEach(function(b){a+="\n	"+b.toString().replace(/\n/g,"\n	")+"\n"}),this.Enumerations.forEach(function(b){a+="\n	"+b.toString().replace(/\n/g,"\n	")+"\n"}),this.Exceptions.forEach(function(b){a+="\n	"+b.toString().replace(/\n/g,"\n	")+"\n"}),this.Events.forEach(function(b){a+="\n	"+b.toString().replace(/\n/g,"\n	")+"\n"}),a+="}"},this}function n(){return this.Service="",this.Attributes=[],this.Types=[],this.Typedefs=[],this.Enumerations=[],this.Exceptions=[],this.Events=[],this.Interfaces={},this.getAttribute=e,this.getDescription=f,this.Version=g,this.getType=function(a){return c(this.Types,a)},this.getTypedef=function(a){return c(this.Typedefs,a)},this.getEnumeration=function(a){return c(this.Enumerations,a)},this.getEvent=function(a){return c(this.Events,a)},this.getException=function(a){return c(this.Exceptions,a)},this.getInterface=function(a){return d(this.Interfaces,a)},this.toString=function(){var a="",b="",c="",d=this.getAttribute("tidl");null!==d&&("1"!=d.Values[0][0]?(a+=d.toString()+"\n",a+="service "+this.Service+" {\n",b="}",c="	"):a+=d.toString()+"\n"),this.Attributes.forEach(function(b){"tidl"!==b.Name&&(a+=c+b.toString()+"\n")}),this.Types.forEach(function(b){a+="\n"+c+b.toString().replace(/\n/g,"\n"+c)+"\n"}),this.Enumerations.forEach(function(b){a+="\n"+c+b.toString().replace(/\n/g,"\n"+c)+"\n"}),this.Exceptions.forEach(function(b){a+="\n"+c+b.toString().replace(/\n/g,"\n"+c)+"\n"}),this.Events.forEach(function(b){a+="\n"+c+b.toString().replace(/\n/g,"\n"+c)+"\n"});for(var e in this.Interfaces){var f=this.Interfaces[e];a+="\n"+c+f.toString().replace(/\n/g,"\n"+c)+"\n"}return a+=b},this}function o(b){return b=b.replace("//","/"),b="/"==b[0]?b.substr(1):b,a(b,"/")?b.substr(0,b.length-1):b}function q(a,b,c,d){var e="";if(null===b||void 0===b)return e;if(null!==b.Operations&&b.Operations.length>0){var f=null;for(var g in b.Operations){if(f=b.Operations[g],f.Name==a.Name)break;f=null}if(null===f)return e;var h=f.getAttribute(C);if(c==C&&null!==h)return h.Values[0];var i=f.getAttribute(D);if(c==D&&null!==i)return i.Values[0];var j=f.getAttribute(E);if(c==E&&null!==j)return j.Values[0];var k=f.getAttribute(G,d);if(c==G&&null!==k)return k.Values[0]}return e}function r(b,c){var d=q(b,c,D),e=q(b,c,E),f=0,g=null;if(null===d||""===d){for(f=0;f<B.length;++f){var h=B[f];if(0===b.Name.toLowerCase().indexOf(h[0].toLowerCase())){g=h;break}}d=null!==g?g[1]:"GET"}if("GET"==d||"DELETE"==d){e&&""!==e&&(d="POST");for(var i in b.Parameters)a(i,H)&&(d="POST")}return d}function s(b){return a(b.Name,H)?b.Name.substr(0,b.Name.length-8):b.Name}function t(b,c,d,e){if((null===d||void 0===d||""===d)&&a(b.Name,H))return!0;if(null!==d&&void 0!==d&&""!==d&&b.Name==d)return!0;if(null!==e&&""!==e)return!0;if(null===c||void 0===c||""===c){if(b.Mandatory&&0!==b.Type.Name.indexOf("set")&&0!==b.Type.Name.indexOf("list"))return!0}else if(c.indexOf("{"+b.Name+"}")>0)return!0;return!1}function u(b,c){var d=(q(b,c,C),q(b,c,E));if(null!==d&&void 0!==d&&""!==d)return d;for(var e in b.Parameters){var f=b.Parameters[e];if((null===d||void 0===d||""===d)&&a(f.Name,H))return e}return""}function v(a,b){var c=q(a,b,C),d=q(a,b,E),e="",f=!0,g="";for(var h in a.Parameters){var i=a.Parameters[h];e=q(a,b,G,i.Name),t(i,c,d,e)||(f?(g+="?",f=!1):g+="&",g+=s(i)+"={"+s(i)+"...}")}return g}function w(b,c,d){var e=q(b,d,C);if(e&&""!==e)return o(e);var f=0,g=null;for(f=0;f<B.length;++f){var h=B[f];if(0===b.Name.toLowerCase().indexOf(h[0].toLowerCase())){g=h;break}}e=null!==g?g[2]:"";var i=b.Name;a(b.Name,"Feed")&&(e+="feed",i=i.substr(0,i.length-4)),a(b.Name.toLowerCase(),c.Name.toLowerCase())&&(i=i.substr(0,i.length-c.Name.length));var j="";null!==g&&g[0].length!=i.length&&(j="/"+i.substr(g[0].length).toLowerCase());var k="",l="";for(var m in b.Parameters){var n=b.Parameters[m];n.Mandatory&&!a(n.Name,H)&&"set"!=n.Type.Name&&"list"!=n.Type.Name&&(a(j.toLowerCase(),"by"+n.Name.toLowerCase())||a(j.toLowerCase(),"to"+n.Name.toLowerCase())?(l="/{"+n.Name.toLowerCase()+"}"+j.substr(0,j.length-(n.Name.length+2)),j=l):a(j.toLowerCase(),"from"+n.Name.toLowerCase())?(l="/{"+n.Name.toLowerCase()+"}"+j.substr(0,j.length-(n.Name.length+4)),j=l):a(j.toLowerCase(),n.Name.toLowerCase())?j="/{"+n.Name.toLowerCase()+"}":k+="/{"+n.Name.toLowerCase()+"}")}return e+=j,null!==g&&null!==g[3]&&""!==g[3]?e+="/"+g[3]:null===g||null!==g[3]&&""!==g[3]||g[1].toLowerCase()==r(b,d).toLowerCase()?null===g&&a(i.toLowerCase(),c.Name.toLowerCase())&&(e+="/"+i.toLowerCase().substr(0,i.length-c.Name.length)):e+="/"+g[0],e+=k,o(e)}function x(a,b){var c,d,e,f="500";if(null===b||void 0===b)return f;for(c in b.Exceptions)if(d=b.Exceptions[c],d.Name===a.Name&&(e=d.getAttribute(F),null!==e&&void 0!==e&&e.Values.length>0))return e.Values[0].trim();for(var g in b.Interfaces){intfAnno=b.Interfaces[g];for(c in intfAnno.Exceptions)if(d=intfAnno.Exceptions[c],d.Name===a.Name&&(e=d.getAttribute(F),null!==e&&void 0!==e&&e.Values.length>0))return e.Values[0].trim()}return f.trim()}function y(a){function b(a,b){for(var c=0;c<a.length;c++)if("function"==typeof b){var d=b(a[c],c);if(d)return a[c]}else if(a[c]==b)return b;return!1}function c(a){return function(b,c){for(var d,e="",f=!1,g=!1;d=b.next();){if(d===a&&!g){f=!0;break}e+=d,g=!g&&"\\"===d}f&&c.tokenizers.shift();var h="`"===a||")"===a?"quote":"string";c.lastToken="v";var i=c.context[0];if(i)try{i.Values[i.Values.length-1]=i.Values[i.Values.length-1]+e.replace(/\\/g,"")+(f?"":"\n")}catch(j){}return h+c.ec}}function d(){return function(a,b){for(var c,d=!1;c=a.next();)if(c+a.peek()==="*/"){a.next(),d=!0;break}d&&b.tokenizers.shift();var e="comment";return e}}function e(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var e,f=c.context[0];if(""===c.lastToken||","==c.lastToken){if(null!==(e=a.match(s)))return c.lastToken="i",f.push(e[0]),b(t,e[0])?"builtin":"variable-2"}else if("i"==c.lastToken){if(a.eat(","))return c.lastToken=",",null;if(a.eat("{"))return c.context.shift(),c.tokenizers.shift(),c.lastToken="",c.tokenizers.unshift(j()),"bracket"}return a.next(),"error error-mark m-2003"}}function f(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var e,f=c.context[0],h=c.context[1];return""!==f.Name?"<"==a.peek()?(a.next(),c.lastToken="<",c.context.unshift([]),c.tokenizers.unshift(g()),"operator"):(h instanceof Array&&h.push(f),c.context.shift(),c.tokenizers.shift(),r(a,c)):null!==(e=a.match(s))?(f.Name=e[0],c.lastToken="t",b(t,e[0])?"builtin":"variable-2"):void 0}}function g(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var e,h,i=c.context[0],j=c.context[1];if("<"==c.lastToken||","==c.lastToken){if(null!==(e=a.match(s,!1)))return c.context.unshift(new z.IdlType),c.tokenizers.unshift(f()),r(a,c)}else if("t"==c.lastToken){if(a.eat(","))return c.lastToken=",",null;if(a.eat(">"))return c.lastToken=">",j.Types=i.concat([]),c.context.shift(),c.tokenizers.shift(),"operator"}return a.eat(",")?null:a.eat("<")?(h=obj.parameters[obj.parameters.length-1],c.context.unshift(h),c.tokenizers.unshift(g()),"operator"):null!==(e=a.match(s))?(h={name:e[0],type:"dataType",parameters:[]},obj.parameters.push(h),b(t,e[0])?"builtin":"variable-2"):a.eat(">")?(c.context.shift(),c.tokenizers.shift(),"operator"):(a.skipToEnd(),c.tokenizers.shift(),c.context.shift(),"error")}}function h(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var e,g=c.context[0],h=c.context[1];return null!==(e=a.match(s,!1))?"mandatory"==e[0]&&"enumeration"!=h.type&&g.Mandatory===!1?(a.match(s),g.Modifiers.push(e[0]),g.Mandatory=!0,"keyword"):"enumeration"==h.type?(a.match(s),g.Name=e[0],c.lastToken="p",h.Parameters[g.Name]=g,c.context.shift(),c.tokenizers.shift(),h.Parameters[e[0]]=g,"variable"):""===g.Type.Name?(c.context.unshift(g.Type),c.tokenizers.unshift(f()),r(a,c)):(g.Name=e[0],"_"!==g.Name.charAt(0)||b(u,g.Name)?(a.match(s),c.lastToken="p",h.Parameters[g.Name]=g,c.context.shift(),c.tokenizers.shift(),"variable"):(a.next(),"error error-mark m-2008")):(a.next(),"error error-mark m-2003")}}function i(){return function(a,b){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return b.tokenizers.unshift(d()),r(a,b);{var c,e;b.context[0],b.context[1]}if("("==b.lastToken){if(null!==(c=a.match(s,!1)))return e=new z.IdlParam,b.context.unshift(e),b.tokenizers.unshift(h()),r(a,b)}else if("p"==b.lastToken&&a.eat(","))return b.lastToken=",",e=new z.IdlParam,b.context.unshift(e),b.tokenizers.unshift(h()),null;return")"===a.eat(")")?(b.lastToken=")",b.tokenizers.shift(),null):(a.next(),b.inError()?"error"+b.ec:"error error-mark m-2003")}}function j(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);{var e=c.context[0];c.context[1]}if("@"==a.peek()){a.next();var f=new z.IdlAttr;if(null!==(matches=a.match(s,!0))){if(f.Name=matches[0],b(["description","parameter","since","method","urlTemplate","bodyParam","revision","version","exception","return","value","seealso"],f.Name)===!1&&c.setWarn(1007),b(["description","since","method","urlTemplate","bodyParam","return","version"],f.Name))try{b(e.Attributes,function(a){return a.Name==f.Name})&&c.setError(2007)}catch(g){}return c.context.unshift(f),c.tokenizers.unshift(p()),"attribute em"+c.ec}return a.skipToEnd(),c.ec="","error error-mark m-2003"}return"}"==a.peek()?(c.tokenizers.shift(),"bracket"):(a.skipToEnd(),c.tokenizers.shift(),"error error-mark m-2003")}}function k(){return function(a,b){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return b.tokenizers.unshift(d()),r(a,b);var c,f=b.context[0],g=b.context[1];if(""===f.Name){if(null!==(c=a.match(s)))return b.lastToken="i",f.Name=c[0],"operation"==f.type?"def strong":"variable-2 strong"}else{if("i"==b.lastToken&&"("==a.peek())return b.tokenizers.unshift(i()),a.next(),b.lastToken="(",null;if(")"==b.lastToken||"i"==b.lastToken&&"typedef"==f.type){if(null!==(c=a.match(s,!1))){if("throws"==c){if("operation"==f.type)return b.lastToken="",b.context.unshift(f.Exceptions),b.tokenizers.unshift(e()),a.match(s),"keyword"}else if("extends"==c&&("type"==f.type||"typedef"==f.type))return b.lastToken="",b.context.unshift(f.BaseTypes),b.tokenizers.unshift(e()),a.match(s),"keyword"}else if(a.eat("{"))return b.lastToken="",b.tokenizers.unshift(j()),"bracket"}else if(a.eat("}")){b.lastToken="";try{g[f.type.toUpperCase()[0]+f.type.substr(1)+"s"].push(f)}catch(h){}return b.context.shift(),b.tokenizers.shift(),"bracket"}}return a.skipToEnd(),b.tokenizers.shift(),"error error-mark m-2003"}}function l(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var e,g,h=c.context[0],i=c.context[1];if("}"==a.peek()){if(a.next(),c.context.shift(),c.tokenizers.shift(),!c.inError())try{i.Interfaces[h.Name]=h}catch(j){}return"bracket"}if("@"==a.peek()){a.next();var l=new z.IdlAttr;if(null!==(e=a.match(s,!0))){if(l.Name=e[0],b(["description","owner","version","revision","author","reviewer","organisation","namespacePrefix","organisationDomainName"],l.Name)===!1&&c.setWarn(1003),b(["description","version","organisation","namespacePrefix","organisationDomainName"],l.Name))try{b(h.Attributes,function(a){return a.Name==l.Name})&&c.setError(2007)}catch(j){}return c.context.unshift(l),c.tokenizers.unshift(p()),"attribute em"+c.ec}return a.skipToEnd(),c.ec="","error error-mark m-2003"}if(null!==(e=a.match(s,!1))){if(b(["type","typedef","event","exception","enumeration"],e[0]))return a.match(s),g=new z.IdlOps,g.type=e[0],g.Return=new z.IdlType,g.Return.Name=e[0],c.context.unshift(g),c.tokenizers.unshift(k()),"keyword";var m="";return g=new z.IdlOps,g.type="operation","async"===e[0]?(a.match(s),g.IsAsync=!0,m="keyword"):g.IsAsync=!1,c.context.unshift(g),c.context.unshift(g.Return),c.tokenizers.unshift(k()),c.tokenizers.unshift(f()),""!==m?m:r(a,c)}return a.skipToEnd(),c.context.shift(),c.tokenizers.shift(),c.inError()||c.setError(2003),"error"+c.ec}}function m(){return function(a,b){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return b.tokenizers.unshift(d()),r(a,b);var c,e=b.context[0],f=b.context[1],g=f.Service;if(""===e.Service)if(null!==(c=a.match(s))){if(""===e.Name)return e.Name=c[0],b.ec="",b.lastToken="d",e.Name.toUpperCase()[0]!=e.Name[0]?"def info-mark m-3001":"def";if("k"==b.lastToken){if(e.Service=c[0],b.ec="",""!==g){if(e.Service.toLowerCase()!=g.toLowerCase())return b.setError(2012),"error "+b.ec}else{if(e.Service.toUpperCase()[0]!=e.Service[0])return f.Service=e.Service,"def info-mark m-3001";f.Service=e.Service}return"def"}if("exposes"===c[0])return b.lastToken="k",b.ec="","keyword";b.setError(2011)}else if(""!==e.Name)if("{"==a.peek()){if(""!==g)return e.Service=g,a.next(),b.tokenizers.shift(),b.tokenizers.unshift(l()),"bracket";b.setError("k"==b.lastToken?2013:2011)}else b.setError("k"==b.lastToken?2013:2010);else b.setError(2010);return""===e.Service&&""===g||"{"!=a.peek()?(a.skipToEnd(),b.context.shift(),b.tokenizers.shift(),b.inError()||b.setError(2003),"error"+b.ec):(""===e.Service&&(e.Service=g),a.next(),b.tokenizers.shift(),b.tokenizers.unshift(l()),"bracket")}}function n(){return function(a,c){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);{var e,f=c.context[0];c.context[1]}if("}"==a.peek())return a.next(),c.context.shift(),c.tokenizers.shift(),"bracket";if("@"==a.peek()){a.next();var g=new z.IdlAttr;if(null!==(e=a.match(s,!0))){if(g.Name=e[0],b(["description","owner","organisation","namespacePrefix","organisationDomainName"],g.Name)===!1&&c.setWarn(1006),b(["description","organisation","organisationDomainName","namespacePrefix"],g.Name))try{b(f.Attributes,function(a){return a.Name==g.Name})&&c.setError(2007)}catch(h){}return c.context.unshift(g),c.tokenizers.unshift(p()),"attribute em"+c.ec}return a.skipToEnd(),c.ec="","error error-mark m-2003"}if(null!==(e=a.match(/^interface\s/))){var i=new z.IdlIntf;return c.ec="",c.context.unshift(i),c.tokenizers.unshift(m()),"keyword"}if(null!==(e=a.match(s,!1))&&b(["type","typedef","event","exception","enumeration"],e[0])){a.match(s);var j=new z.IdlOps;return j.type=e[0],j.Return=new z.IdlType,j.Return.Name=e[0],c.context.unshift(j),c.tokenizers.unshift(k()),"keyword"}return a.skipToEnd(),c.context.shift(),c.tokenizers.shift(),c.inError()||c.setError(2003),"error"+c.ec}}function o(){return function(a,b){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return b.tokenizers.unshift(d()),r(a,b);{var c,e=b.context[0];b.context[1]}return""===e.Service&&null!==(c=a.match(s))?(e.Service=c[0],b.ec="",e.Service.toUpperCase()[0]!=e.Service[0]?"def info-mark m-3001":"def"):""!==e.Service&&"{"==a.peek()?(a.next(),b.tokenizers.shift(),b.tokenizers.unshift(n()),"bracket"):(a.skipToEnd(),b.context.shift(),b.tokenizers.shift(),b.inError()||b.setError(2003),"error"+b.ec)}}function p(){return function(a,e){if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return e.tokenizers.unshift(d()),r(a,e);var f=e.context[0],g=e.context[1],h=a.peek();if(";"===h){if(a.next(),e.context.shift(),e.tokenizers.shift(),"v"!=e.lastToken)return e.lastToken="",e.ec="","error error-mark m-2003";e.lastToken="";try{e.inError()||g.Attributes.push(f)}catch(i){}return e.ec="",null}var j;if(0===f.Values.length)if(b(["parameter","exception","value"],f.Name)){if(null!==(j=a.match(s)))return f.Values.push(j[0]),f.Type="Parameter",e.lastToken="v","variable "+e.ec;e.inError()||e.setError(2004)}else if(b(["tidl","version","since","revision"],f.Name)){if(null!==(j=a.match(/(\d+\.\d+\.\d+)(?:-([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?(?:\+([0-9A-Za-z-]+(?:\.[0-9A-Za-z-]+)*))?/,!0)))return f.Values.push(j[0]),f.Type="Version",e.lastToken="v","number "+e.ec;e.inError()||e.setError(2005)}else{if('"'==h||"'"==h)return e.lastToken="v",f.Values.push(""),e.tokenizers.unshift(c(a.next(),a.column())),r(a,e);e.inError()||e.setError(2006)}return","==h?(a.next(),"v"!=e.lastToken?(e.setError(2003),e.lastToken=",","error"+e.ec):(e.lastToken=",",null)):'"'==h||"'"==h?(","!=e.lastToken&&e.setError(2003),b(["tidl","description"],f.Name)&&""===e.ec&&e.setWarn(1002),f.Values.push(""),e.tokenizers.unshift(c(a.next(),a.column())),r(a,e)):(a.next(),"error error-mark m-2003")}}function q(a,c){var e;if(a.eatSpace())return null;if(a.match("//"))return a.skipToEnd(),"comment";if(a.match("/*"))return c.tokenizers.unshift(d()),r(a,c);var f=c.context[0];if(a.eat("@")){var g=new z.IdlAttr;if(c.ec="",null!==(e=a.match(s,!0))){if(g.Name=e[0],b(["tidl"],g.Name)===!1)c.setWarn(1001);else try{b(f.Attributes,function(a){return"tidl"==a.Name})&&c.setWarn(1004)}catch(h){}return c.context.unshift(g),c.tokenizers.unshift(p()),"attribute em"+c.ec}return a.skipToEnd(),"error error-mark m-2001"}if(null!==(e=a.match(/^service\s/))){var i=b(f.Attributes,function(a){return"tidl"==a.Name});return i===!1||"2"!=i.Values[0].charAt(0)?(a.skipToEnd(),"error error-mark m-1005"):(c.ec="",c.context.unshift(f),c.tokenizers.unshift(o()),"keyword")}if(null!==(e=a.match(/^interface\s/))){var j=new z.IdlIntf;return c.ec="",c.context.unshift(j),c.tokenizers.unshift(m()),"keyword"}return a.next(),"error error-mark m-2002"}function r(a,b){return(b.tokenizers[0]||q)(a,b)}var s=/^[a-zA-Z_][a-zA-Z0-9_]*/,t=["boolean","byte","short","int","long","float","double","decimal","string","datetime","list","set","map"],u=["_region","_language","_business","_channel","_accept","_userId","_appKey"];return{token:function(a,b){return 0===b.context.length&&b.context.push(b.model),a.eol()?null:r(a,b)},startState:function(){return{tokenizers:[],context:[],lastToken:"",ec:"",model:void 0===a.model?new z.IdlModel:a.model,inError:function(){return-1!==this.ec.indexOf("error-mark")},setError:function(a){this.ec=" error-mark m-"+a},setWarn:function(a){this.ec=" warning-mark m-"+a},setInfo:function(a){this.ec=" info-mark m-"+a}}},copyState:function(a){if(a===!0)return a;var b,c={};for(var d in a){var e=a[d];if(void 0!==e)if(e instanceof Array){var f=[];for(b=0;b<e.length;++b){var g=e[b];f.push(g.clone&&"function"==typeof g.clone?g.clone():g)}e=f}else e.clone&&"function"==typeof e.clone&&(e=e.clone());c[d]=e}return c},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",fold:"brace"}}var z={},A={};A.StringStream=function(a,b){this.pos=this.start=0,this.string=a,this.tabSize=b||8,this.lastColumnPos=this.lastColumnValue=0},A.StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return 0===this.pos},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(a){var b,c=this.string.charAt(this.pos);return b="string"==typeof a?c==a:c&&(a.test?a.test(c):a(c)),b?(++this.pos,c):void 0},eatWhile:function(a){for(var b=this.pos;this.eat(a););return this.pos>b},eatSpace:function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a},skipToEnd:function(){this.pos=this.string.length},skipTo:function(a){var b=this.string.indexOf(a,this.pos);return b>-1?(this.pos=b,!0):void 0},backUp:function(a){this.pos-=a},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=b(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue},indentation:function(){return b(this.string,null,this.tabSize)},match:function(a,b,c){if("string"!=typeof a){var d=this.string.slice(this.pos).match(a);return d&&d.index>0?null:(d&&b!==!1&&(this.pos+=d[0].length),d)}var e=function(a){return c?a.toLowerCase():a},f=this.string.substr(this.pos,a.length);return e(f)==e(a)?(b!==!1&&(this.pos+=a.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)}},A.splitLines=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;d>=b;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var f=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),g=f.indexOf("\r");-1!=g?(c.push(f.slice(0,g)),b+=g+1):(c.push(f),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},this.CodeMirror&&(CodeMirror.defineMode("tidl",y),A.StringStream=CodeMirror.StringStream,A.splitLines=CodeMirror.splitLines),h.prototype.clone=function(){var a=new h;return a.Name=this.Name,a.Type=this.Type,a.Values=this.Values.concat([]),a},h.prototype.updateHeaderMappings=function(a){var b,c=this,d=null,e=null;if(a)for(b=0;b<a.Attributes.length;++b)d=a.Attributes[b],"Parameter"===d.Type&&"parameter"===d.Name&&d.Values[0]===c.Values[0]&&(e=d.Values[1],c.Values.push("headerMapping:"+e))},j.prototype.clone=function(){var a=new j;a.Name=this.Name;for(var b=0;b<this.Types.length;++b){var c=this.Types[b];a.Types.push(c.clone())}return a},k.prototype.clone=function(){var a=new k;return a.Name=this.Name,a.Type=this.Type.clone(),a.Modifiers=this.Modifiers.concat([]),a.Mandatory=this.Mandatory,a},l.prototype.getAttribute=e,l.prototype.getDescription=f,l.prototype.clone=function(){var a,b=new l;b.Name=this.Name,b.Return=this.Return.clone();for(var c in this.Parameters){var d=this.Parameters[c];b.Parameters[d.Name]=d.clone()}for(a=0;a<this.Attributes.length;++a){var e=this.Attributes[a];b.Attributes.push(e.clone())}return b.Exceptions=this.Exceptions.concat([]),b.BaseTypes=this.BaseTypes.concat([]),b.IsAsync=this.IsAsync,b.type=this.type,b},m.prototype.clone=function(){var a,b=new m;for(b.Name=this.Name,b.Service=this.Service,a=0;a<this.Attributes.length;++a){var c=this.Attributes[a];b.Attributes.push(c.clone())}for(a=0;a<this.Operations.length;++a){var d=this.Operations[a];b.Operations.push(d.clone())}for(a=0;a<this.Types.length;++a){var e=this.Types[a];b.Types.push(e.clone())}for(a=0;a<this.Enumerations.length;++a){var f=this.Enumerations[a];b.Enumerations.push(f.clone())}for(a=0;a<this.Exceptions.length;++a){var g=this.Exceptions[a];b.Exceptions.push(g.clone())}for(a=0;a<this.Events.length;++a){var h=this.Events[a];b.Events.push(h.clone())}return b},n.prototype.clone=function(){var a,b=new n;for(b.Service=this.Service,a=0;a<this.Attributes.length;++a){var c=this.Attributes[a].clone();b.Attributes.push(c)}for(a=0;a<this.Types.length;++a){var d=this.Types[a];b.Types.push(d.clone())}for(a=0;a<this.Enumerations.length;++a){var e=this.Enumerations[a];b.Enumerations.push(e.clone())}for(a=0;a<this.Exceptions.length;++a){var f=this.Exceptions[a];b.Exceptions.push(f.clone())}for(a=0;a<this.Events.length;++a){var g=this.Events[a];b.Events.push(g.clone())}for(var h in this.Interfaces){var i=this.Interfaces[h].clone();b.Interfaces[h]=i}return b};var B=[["calculate","GET","",""],["getFrom","GET","",""],["getby","GET","",""],["get","GET","",""],["searchby","GET","","search"],["search","GET","search",""],["history","GET","","history"],["retrieve","POST","","retrieve"],["deleteFrom","DELETE","",""],["delete","DELETE","",""],["update","PUT","",""],["revoke","PUT","","revoke"],["rename","PUT","","rename"],["extend","PUT","","extend"],["unlockAccountBy","PUT","unlockaccount",""],["validate","GET","validate",""],["createOrUpdate","POST","",""],["create","POST","",""],["open","POST","",""],["issue","POST","issue",""],["reserve","POST","","reserve"],["confirm","POST","","confirm"],["unreserve","POST","","unreserve"],["redeem","POST","","redeem"],["restore","POST","","restore"],["activate","POST","","activate"],["deactivate","POST","","deactivate"],["approve","POST","","approve"],["reject","POST","","reject"],["add","POST","",""],["propose","POST","",""],["adjust","POST","adjust",""],["move","POST","move",""],["render","POST","","render"],["register","POST","",""],["reject","DELETE","",""],["remove","DELETE","",""],["cancel","DELETE","",""],["close","DELETE","",""]],C="urlTemplate",D="method",E="bodyParam",F="statusCode",G="parameter",H="FromBody";n.prototype.updateEndpoints=function(a){var b,c,d=this,e=null,f=null,g=null,i=null,k=null,m=null;for(var n in d.Interfaces){if(f=d.Interfaces[n],c=0===f.Version().Major?d.Version().Major:f.Version().Major,a)try{g=a.Interfaces[n]}catch(o){g=null}else g=null;for(var p in f.Operations)if(k=f.Operations[p],e=null,"_"!==k.Name[0]){for(g&&(i=g.getOperation(k.Name)),b=0;b<k.Attributes.length;++b)m=k.Attributes[b],m.updateHeaderMappings(i),"restendpoint"===m.Name&&(e=m);null===e?(e=new h,e.Name="restendpoint",k.Attributes.push(e)):e.Values=[],e.Values.push(r(k,g)),e.Values.push("v"+c+"/"+f.Name.toLowerCase()+"/"+w(k,f,g)),e.Values.push(v(k,g)),e.Values.push(u(k,g))}if(null===f.getOperation("_status")&&(k=new l,k.Name="_status",k.Return=new j,k.Return.Name="_APIStatus",k.Attributes=[],e=new h,e.Name="restendpoint",e.Values.push("GET"),e.Values.push("v"+c+"/"+f.Name.toLowerCase()+"/_status/"),e.Values.push(""),e.Values.push(""),k.Attributes.push(e),k.type="operation",f.Operations.push(k)),null===f.getType("_APIStatus")){k=new l,k.Name="_APIStatus",k.Return.Name="type",k.type="type",k.Parameters.status=new j,k.Parameters.status.Name="status",k.Parameters.status.Type=new j,k.Parameters.status.Type.Name="string",k.Parameters.status.Modifiers=["mandatory"],k.Parameters.status.Mandatory=!0,k.Attributes=[];var q=new h;q.Name="parameter",q.Type="parameter",q.Values=[].concat(["status","status of the API","ok"]),k.Attributes.push(q),f.Types.push(k)}null===f.getOperation("_interface")&&(k=new l,k.Name="_interface",k.Return=new j,k.Return.Name="IdlIntf",k.Attributes=[],e=new h,e.Name="restendpoint",e.Values.push("GET"),e.Values.push("v"+c+"/"+f.Name.toLowerCase()+"/_interface/"),e.Values.push(""),e.Values.push(""),k.Attributes.push(e),k.type="operation",f.Operations.push(k))}},n.prototype.updateExceptionTypes=function(a){var b,c,d,e=this;for(c in e.Exceptions){d=e.Exceptions[c];var f=null;for(b=0;b<d.Attributes.length;++b)if("resthttpstatus"==d.Attributes[b].Name){f=d.Attributes[b];break}null===f?(f=new h,f.Name="resthttpstatus",d.Attributes.push(f)):f.Values=[],f.Values.push(x(d,a))}for(var g in e.Interfaces){var i=e.Interfaces[g];for(c in i.Exceptions){d=i.Exceptions[c];var j=null;for(b=0;b<d.Attributes.length;++b)if("resthttpstatus"==d.Attributes[b].Name){j=d.Attributes[b];break}null===j?(j=new h,j.Name="resthttpstatus",d.Attributes.push(j)):j.Values=[],j.Values.push(x(d,a))}}},z.IdlModel=n,z.IdlAttr=h,z.IdlIntf=m,z.IdlOps=l,z.IdlType=j,z.IdlParam=k,z.Messages={1000:"Unknown error",1001:"Unsupported attribute: Expecting 'tidl' attribute.",1002:"Unused value: Will be ignored.",1003:"Unsupported attribute: Expecting one of 'description', 'owner', 'version', 'revision', 'author', 'reviewer', 'organisation', 'namespacePrefix', 'organisationDomainName'.",1004:"Duplicate: Will be ignored.",1005:"Unsupported in tidl 1.x.x files, please change the tidl version to 2.0.0;",1006:"Unsupported attribute: Expecting one of 'description', 'owner', 'organisation', 'namespacePrefix', 'organisationDomainName'.",1007:"Unsupported attribute: Expecting one of 'description', 'parameter', 'since','revision', 'exception', 'return','value','seealso'.",2001:"Unexpected character: Expecting an attribute type like description, parameter etc,.",2002:"Unexpected character: Expecting an attribute or a interface definition.",2003:"Unexpected character: Bad syntax.",2004:"Unexpected character: Expecting an ID as the first value for the attributes 'parameter', 'exception' or 'value'.",2005:"Unexpected character: Expecting an n.n.n version as the first value for the attributes 'tidl', 'version', 'since' or 'revision'.",2006:"Unexpected character: Expecting a string as the first value for the attribute.",2007:"Duplicate: there can only be one instance per scope.",2008:"Unrecognized reserved parameter: Only reserved parameter names can begin with underscore.",2009:"",2010:"Unexpected character: Expected a valid interface name.",2011:"Unexpected character: Expected 'exposes' keyword.",2012:"Mismatched Service. The Service Name in Service decleration and interface do not match.",2013:"Unexpected character. Expecting a valid service name.",3001:"Standards: Suggested to start with a capital letter."},z.parseWithAnnotations=function(a,b){var c=z.parse(a),d=null;
return b&&(d=z.parse(b)),null!==c&&null!==c.model&&(null!==d&&null!==d.model?(c.model.updateEndpoints(d.model),c.model.updateExceptionTypes(d.model)):(c.model.updateEndpoints(null),c.model.updateExceptionTypes(null))),[c,d]},z.parse=function(a,b){var c=y({},{}),d=c.startState(),e=[];if(null===a||void 0===a)return null;var f=A.splitLines(a);return f.forEach(function(a,f){for(var g,h=new A.StringStream(a,b||4),i=c.token;!h.eol();){var j=h.pos;g=i(h,d),h.start=h.pos;var k=h.pos;if(g){var l=-1!=g.indexOf("error-mark"),m=-1!=g.indexOf("warning-mark"),n=-1!=g.indexOf("info-mark");if(l||m||n){var o=g.indexOf("m-"),p=g.substr(o+2);e.push({line:f+1,col:j,charcount:k-j,code:p,type:l?"error":m?"warning":"info"})}}}}),d.context.length>0&&d.context[0]!==d.model&&e.push({line:f.length,col:f[f.length-1].length-1,charcount:1,code:"2003",type:"error"}),d.model.updateEndpoints(d.model),d.model.updateExceptionTypes(d.model),{model:d.model,messages:e}};var I=function(a){var b=a;if("#"===a[0]){var c=a.substr(2).split("/");return c[c.length-1]}return b},J=function(a,b){if("#"===a[0]){var c=a.substr(2).split("/"),d=b;return c.forEach(function(a){d=d[a]}),d}return b.definitions[a]},K=function(a,b){var c=new z.IdlType,d=a;return a.$ref?(d=J(a.$ref,b),c.Name=I(a.$ref)):"array"===d.type?(c.Name="list",d.items&&c.Types.push(K(d.items,b))):c.Name=d.type,c};z.fromSwagger=function(a){var b=new z.IdlModel,c=[],d={model:b,messages:c};if(null===a||void 0===a)return c.push({code:"10000",type:"error",message:"swagger object cannot be null or undefined."}),d;if(void 0===a.swagger)return c.push({code:"10001",type:"error",message:"swagger object does NOT contain swagger property."}),d;if("2.0"!==a.swagger)return c.push({code:"10002",type:"error",message:"supports only 2.0 version."}),d;var e=new z.IdlAttr;if(e.Name="tidl",e.Type="Version",e.Values.push("2.0.0"),b.Attributes.push(e),null===a.info||void 0===a.info)return c.push({code:"10003",type:"error",message:"info object cannot be null or undefined."}),d;if(null===a.info.title||void 0===a.info.title)return c.push({code:"10004",type:"error",message:"title property on info object cannot be null or undefined."}),d;b.Service=a.info.title;var f=b.Service.indexOf(" ");if(-1!==f&&(b.Service=b.Service.substr(0,f)),a.info.description){var g=new z.IdlAttr;g.Name="description",g.Values.push(a.info.description),b.Attributes.push(g)}if(a.info.contact){var h=new z.IdlAttr;h.Name="owner",h.Values.push(a.info.contact.name?a.info.contact.name:""),h.Values.push(a.info.contact.email?a.info.contact.email:""),a.info.contact.url&&h.Values.push(a.info.contact.url),b.Attributes.push(h)}var i=new z.IdlAttr;i.Name="version",i.Type="Version",i.Values.push(a.info.version?a.info.version:"0.0.1");for(var j in a.paths)if("/"===j.charAt(0)){var k=a.paths[j],l=j.substr(1);f=l.indexOf("/"),-1!==f&&(l=l.substr(0,f));var m=b.Interfaces[l];void 0===m&&(m=new z.IdlIntf,m.Name=l,b.Interfaces[l]=m,m.Attributes.push(i));for(var n in k)if("$ref"!==n){var o=new z.IdlOps;o.type="operation";var q=k[n];if(o.Name=q.operationId?q.operationId:n.toLowerCase(),q.summary||q.description){var r=new z.IdlAttr;r.Name="description",r.Values.push((q.summary||"")+"\n"+(q.description||"")),o.Attributes.push(r)}var s=new z.IdlAttr;s.Name="urlTemplate",s.Values.push(j),o.Attributes.push(s);var t=new z.IdlAttr;if(t.Name="method",t.Values.push(n.toUpperCase()),o.Attributes.push(t),q.responses){for(var u in q.responses){var v=q.responses[u],w=new z.IdlAttr;if(v.description&&(w.Values.push(v.description),o.Attributes.push(w)),"2"===u[0]||"default"===u)v.schema&&(o.Return=K(v.schema,a)),w.Name="return",w.Values.push(v.description);else{var x=new z.IdlOps;x.type="exception",x.Name=o.Name+"_"+u+"Exception",o.Exceptions.push(x.Name),v.description&&(w.Name="exception",w.Type="Parameter",w.Values[0]=x.Name,w.Values.push(v.description));var y=new z.IdlAttr;y.Name="statusCode",y.Values.push(u),x.Attributes.push(y),m.Exceptions.push(x)}}o.Return.Name||(o.Return=new z.IdlType,o.Return.Name="void")}else o.Return=new z.IdlType,o.Return.Name="void";if(q.parameters)for(p=0;p<q.parameters.length;p++){var A=q.parameters[p],B=new z.IdlParam;if(A.required&&(B.Mandatory=!0),B.Name=A.name,A.type?"array"===A.type?(B.Type.Name="list",B.Type.Types.push(K(A.items,a))):B.Type.Name=A.type:B.Type=K(A.schema,a),o.Parameters[B.Name]=B,"body"===A.in){var C=new z.IdlAttr;C.Name="bodyParam",C.Values.push(B.Name),o.Attributes.push(C)}}m.Operations.push(o)}}return d};var L=this,M=L.tidl;"undefined"!=typeof module&&module.exports?module.exports=z:L.tidl=z,z.noConflict=function(){return L.tidl=M,z}}(this);